<!DOCTYPE HTML>
<html lang="zh-tw" >
    <!-- Start book 反扒以及解决方案 -->
<!-- Start book 反扒以及解决方案 -->
    <head>
        <!-- head:start -->
<!-- head:start -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>案例：百度翻译sign值获取 | 反扒以及解决方案</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-maxiang/maxiang.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-splitter/splitter.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-emphasize/plugin.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../02-常见的其他反扒以及解决方式/06-使用代理.html" />
    
    
    <link rel="prev" href="../02-常见的其他反扒以及解决方式/04-JS的解析.html" />
    

        <!-- head:end -->
<!-- head:end -->
    </head>
    <body>
        <!-- body:start -->
<!-- body:start -->
        
    <div class="book"
        data-level="3.4"
        data-chapter-title="案例：百度翻译sign值获取"
        data-filepath="02-常见的其他反扒以及解决方式/05-案例：百度翻译sign值获取.md"
        data-basepath=".."
        data-revision="Thu Sep 05 2019 11:08:14 GMT+0800 (CST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        联系方式
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="01-selenium/index.html">
            
                
                    <a href="../01-selenium/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Selenium
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="01-selenium/01-Selenium介绍.html">
            
                
                    <a href="../01-selenium/01-Selenium介绍.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Selenium介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="01-selenium/02-selenium的基本使用.html">
            
                
                    <a href="../01-selenium/02-selenium的基本使用.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Selenium的基本使用
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="01-selenium/03-元素定位的方法.html">
            
                
                    <a href="../01-selenium/03-元素定位的方法.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        元素定位的方法
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="01-selenium/04-selenium的其他方法.html">
            
                
                    <a href="../01-selenium/04-selenium的其他方法.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        Selenium的其他方法
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="01-selenium/05-案例：斗鱼爬虫.html">
            
                
                    <a href="../01-selenium/05-案例：斗鱼爬虫.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Selenium案例：斗鱼爬虫
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="02-常见的其他反扒以及解决方式/index.html">
            
                
                    <a href="../02-常见的其他反扒以及解决方式/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        常见的其他反扒以及解决方式
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="02-常见的其他反扒以及解决方式/01-常见的反爬手段和解决思路.html">
            
                
                    <a href="../02-常见的其他反扒以及解决方式/01-常见的反爬手段和解决思路.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        常见的反爬手段和解决思路
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="02-常见的其他反扒以及解决方式/02-打码平台的使用.html">
            
                
                    <a href="../02-常见的其他反扒以及解决方式/02-打码平台的使用.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        打码平台的使用
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="02-常见的其他反扒以及解决方式/04-JS的解析.html">
            
                
                    <a href="../02-常见的其他反扒以及解决方式/04-JS的解析.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        JS的解析
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="3.4" data-path="02-常见的其他反扒以及解决方式/05-案例：百度翻译sign值获取.html">
            
                
                    <a href="../02-常见的其他反扒以及解决方式/05-案例：百度翻译sign值获取.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        案例：百度翻译sign值获取
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="02-常见的其他反扒以及解决方式/06-使用代理.html">
            
                
                    <a href="../02-常见的其他反扒以及解决方式/06-使用代理.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        使用代理
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    本書使用 GitBook 釋出
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >反扒以及解决方案</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="&#x767E;&#x5EA6;&#x7FFB;&#x8BD1;&#x722C;&#x866B;&#x5E26;&#x6709;sign&#x503C;">&#x767E;&#x5EA6;&#x7FFB;&#x8BD1;&#x722C;&#x866B;(&#x5E26;&#x6709;sign&#x503C;)</h1>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> js2py
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> re


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_sign</span><span class="hljs-params">(word=<span class="hljs-string">&quot;&#x4F60;&#x597D;&quot;</span>)</span>:</span>

    <span class="hljs-comment"># &#x6574;&#x7406;&#x8BF7;&#x6C42;&#x5934;</span>
    headers = {
        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.139 Safari/537.36&quot;</span>
    }

    <span class="hljs-comment"># &#x83B7;&#x53D6;&#x8BF7;&#x6C42;</span>
    response = requests.get(<span class="hljs-string">&quot;http://fanyi.baidu.com/&quot;</span>, headers=headers)

    gtk = re.findall(<span class="hljs-string">&quot;;window.gtk = (&apos;.*?&apos;);&quot;</span>, response.content.decode())[<span class="hljs-number">0</span>]
    <span class="hljs-comment"># print(gtk)</span>

    <span class="hljs-comment"># word = &quot;&#x4F60;&#x597D;&quot;</span>

    context = js2py.EvalJs()
    js = <span class="hljs-string">r&apos;&apos;&apos;
        function a(r) {
            if (Array.isArray(r)) {
                for (var o = 0, t = Array(r.length); o &lt; r.length; o++)
                    t[o] = r[o];
                return t
            }
            return Array.from(r)
        }
        function n(r, o) {
            for (var t = 0; t &lt; o.length - 2; t += 3) {
                var a = o.charAt(t + 2);
                a = a &gt;= &quot;a&quot; ? a.charCodeAt(0) - 87 : Number(a),
                    a = &quot;+&quot; === o.charAt(t + 1) ? r &gt;&gt;&gt; a : r &lt;&lt; a,
                    r = &quot;+&quot; === o.charAt(t) ? r + a &amp; 4294967295 : r ^ a
            }
            return r
        }
        function e(r) {
            var o = r.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g);
            if (null === o) {
                var t = r.length;
                t &gt; 30 &amp;&amp; (r = &quot;&quot; + r.substr(0, 10) + r.substr(Math.floor(t / 2) - 5, 10) + r.substr(-10, 10))
            } else {
                for (var e = r.split(/[\uD800-\uDBFF][\uDC00-\uDFFF]/), C = 0, h = e.length, f = []; h &gt; C; C++)
                    &quot;&quot; !== e[C] &amp;&amp; f.push.apply(f, a(e[C].split(&quot;&quot;))),
                    C !== h - 1 &amp;&amp; f.push(o[C]);
                var g = f.length;
                g &gt; 30 &amp;&amp; (r = f.slice(0, 10).join(&quot;&quot;) + f.slice(Math.floor(g / 2) - 5, Math.floor(g / 2) + 5).join(&quot;&quot;) + f.slice(-10).join(&quot;&quot;))
            }
            var u = void 0
                , l = &quot;&quot; + String.fromCharCode(103) + String.fromCharCode(116) + String.fromCharCode(107);
            u = &apos;null !== i ? i : (i = window[l] || &quot;&quot;) || &quot;&quot;&apos;;
            for (var d = u.split(&quot;.&quot;), m = Number(d[0]) || 0, s = Number(d[1]) || 0, S = [], c = 0, v = 0; v &lt; r.length; v++) {
                var A = r.charCodeAt(v);
                128 &gt; A ? S[c++] = A : (2048 &gt; A ? S[c++] = A &gt;&gt; 6 | 192 : (55296 === (64512 &amp; A) &amp;&amp; v + 1 &lt; r.length &amp;&amp; 56320 === (64512 &amp; r.charCodeAt(v + 1)) ? (A = 65536 + ((1023 &amp; A) &lt;&lt; 10) + (1023 &amp; r.charCodeAt(++v)),
                    S[c++] = A &gt;&gt; 18 | 240,
                    S[c++] = A &gt;&gt; 12 &amp; 63 | 128) : S[c++] = A &gt;&gt; 12 | 224,
                    S[c++] = A &gt;&gt; 6 &amp; 63 | 128),
                    S[c++] = 63 &amp; A | 128)
            }
            for (var p = m, F = &quot;&quot; + String.fromCharCode(43) + String.fromCharCode(45) + String.fromCharCode(97) + (&quot;&quot; + String.fromCharCode(94) + String.fromCharCode(43) + String.fromCharCode(54)), D = &quot;&quot; + String.fromCharCode(43) + String.fromCharCode(45) + String.fromCharCode(51) + (&quot;&quot; + String.fromCharCode(94) + String.fromCharCode(43) + String.fromCharCode(98)) + (&quot;&quot; + String.fromCharCode(43) + String.fromCharCode(45) + String.fromCharCode(102)), b = 0; b &lt; S.length; b++)
                p += S[b],
                    p = n(p, F);
            return p = n(p, D),
                p ^= s,
            0 &gt; p &amp;&amp; (p = (2147483647 &amp; p) + 2147483648),
                p %= 1e6,
            p.toString() + &quot;.&quot; + (p ^ m)
        }
    &apos;&apos;&apos;</span>

    <span class="hljs-comment"># js&#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x884C;gtk</span>
    js = js.replace(<span class="hljs-string">&apos;\&apos;null !== i ? i : (i = window[l] || &quot;&quot;) || &quot;&quot;\&apos;&apos;</span>, gtk)
    <span class="hljs-comment"># print(js)</span>

    <span class="hljs-comment"># &#x6267;&#x884C;js</span>
    context.execute(js)
    <span class="hljs-comment"># &#x8C03;&#x7528;&#x51FD;&#x6570;&#x5F97;&#x5230;sign</span>
    sign = context.e(word)
    print(<span class="hljs-string">&quot;&gt;&gt;&gt;sign&#xFF1A;&quot;</span>, sign)  <span class="hljs-comment"># 232427.485594</span>
    <span class="hljs-keyword">return</span> sign

    <span class="hljs-comment"># from: zh</span>
    <span class="hljs-comment"># to: en</span>
    <span class="hljs-comment"># query: &#x4F60;&#x597D;</span>
    <span class="hljs-comment"># transtype: translang</span>
    <span class="hljs-comment"># simple_means_flag: 3</span>
    <span class="hljs-comment"># sign: *232427.485594*</span>
    <span class="hljs-comment"># token: 7d7ebd2b6584d2ce094f7d64aa6d7f9f</span>


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">baidu_translate</span><span class="hljs-params">(text, sign)</span>:</span>
    url = <span class="hljs-string">&quot;https://fanyi.baidu.com/basetrans&quot;</span>
    data = {
        <span class="hljs-string">&quot;query&quot;</span>: text,
        <span class="hljs-string">&quot;from&quot;</span>: <span class="hljs-string">&quot;en&quot;</span>,
        <span class="hljs-string">&quot;to&quot;</span>: <span class="hljs-string">&quot;zh&quot;</span>,
        <span class="hljs-string">&quot;token&quot;</span>: <span class="hljs-string">&quot;c4eda15d24c81f426053e251f6dbd534&quot;</span>,
        <span class="hljs-string">&quot;sign&quot;</span>: sign
    }

    headers = {
        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1&quot;</span>,
    }

    cookies_str = <span class="hljs-string">&quot;BIDUPSID=17E4B76CEDABD07968243F570B0ADE1D; PSTM=1561512047; REALTIME_TRANS_SWITCH=1; FANYI_WORD_SWITCH=1; HISTORY_SWITCH=1; SOUND_SPD_SWITCH=1; SOUND_PREFER_SWITCH=1; BAIDUID=17E4B76CEDABD07968243F570B0ADE1D:SL=0:NR=10:FG=1; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; to_lang_often=%5B%7B%22value%22%3A%22zh%22%2C%22text%22%3A%22%u4E2D%u6587%22%7D%2C%7B%22value%22%3A%22en%22%2C%22text%22%3A%22%u82F1%u8BED%22%7D%5D; __cfduid=d4b4db75d02633926b5959ec9dc5c9f271562924941; MCITY=-%3A; H_PS_PSSID=1429_21083_29523_29520_29238_28519_29099_28837_29221_26350_29458; delPer=0; PSINO=3; locale=zh; Hm_lvt_64ecd82404c51e03dc91cb9e8c025574=1562686706,1562849490,1562894655,1563114174; from_lang_often=%5B%7B%22value%22%3A%22zh%22%2C%22text%22%3A%22%u4E2D%u6587%22%7D%2C%7B%22value%22%3A%22en%22%2C%22text%22%3A%22%u82F1%u8BED%22%7D%5D; Hm_lvt_afd111fa62852d1f37001d1f980b6800=1561982058,1562155796,1563115393; Hm_lpvt_afd111fa62852d1f37001d1f980b6800=1563115393; Hm_lpvt_64ecd82404c51e03dc91cb9e8c025574=1563115393; yjs_js_security_passport=6c7b3b97a45760e9bc9b971e961e1d7721e606ad_1563115397_js&quot;</span>
    cookies_dict = {temp[:temp.find(<span class="hljs-string">&quot;=&quot;</span>)]: temp[temp.find(<span class="hljs-string">&quot;=&quot;</span>) + <span class="hljs-number">1</span>:] <span class="hljs-keyword">for</span> temp <span class="hljs-keyword">in</span> cookies_str.split(<span class="hljs-string">&quot;; &quot;</span>)}
    <span class="hljs-comment"># print(&quot;\n\n\n&quot;)</span>
    <span class="hljs-comment"># print(cookies_dict)  # &#x67E5;&#x770B; &#x5C06;&#x5B57;&#x7B26;&#x4E32;&#x7684;cookies&#x8F6C;&#x6362;&#x4E3A;&#x5B57;&#x5178;&#x5F62;&#x5F0F;&#x4E4B;&#x540E;&#x7684;&#x6837;&#x5B50;</span>

    response = requests.post(url=url, data=data, headers=headers, cookies=cookies_dict)

    ret = json.loads(response.content.decode())
    print(<span class="hljs-string">&quot;\n\n\n&quot;</span>)
    print(type(ret))
    translate_ret = ret[<span class="hljs-string">&quot;trans&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;dst&quot;</span>]
    print(translate_ret)
    <span class="hljs-keyword">return</span> translate_ret


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:
    <span class="hljs-comment"># 1. &#x8F93;&#x5165;&#x8981;&#x7FFB;&#x8BD1;&#x7684;&#x82F1;&#x6587;</span>
    text = input(<span class="hljs-string">&quot;&#x8BF7;&#x8F93;&#x5165;&#x8981;&#x7FFB;&#x8BD1;&#x7684;&#x82F1;&#x6587;:&quot;</span>)
    <span class="hljs-comment"># 2. &#x8BA1;&#x7B97;&#x51FA;sign</span>
    sign = get_sign(text)
    <span class="hljs-comment"># 3. &#x53D1;&#x9001;&#x7FFB;&#x8BD1;&#x8BF7;&#x6C42;</span>
    ret = baidu_translate(text, sign)
    print(<span class="hljs-string">&quot;&#x82F1;&#x6587;:&quot;</span>, text, <span class="hljs-string">&quot;&#x7FFB;&#x8BD1;&#x4E3A;&#x5E94;&#x4E3A;&#xFF1A;&quot;</span>, ret)
</code></pre>
<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</p>
<p>&#x5F00;&#x59CB;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x8F93;&#x5165;&#x4EFB;&#x610F;&#x82F1;&#x8BED;&#xFF0C;&#x5373;&#x53EF;&#x7FFB;&#x8BD1;&#x4E3A;&#x4E2D;&#x6587;</p>
<p><img src="assets/image-20190714225631201.png" alt="image-20190714225631201"></p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../02-常见的其他反扒以及解决方式/04-JS的解析.html" class="navigation navigation-prev " aria-label="Previous page: JS的解析"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../02-常见的其他反扒以及解决方式/06-使用代理.html" class="navigation navigation-next " aria-label="Next page: 使用代理"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-maxiang/maxiang.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-splitter/splitter.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-book-summary-scroll-position-saver/book-summary-scroll-position-saver.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"maxiang":{},"toggle-chapters":{},"splitter":{},"emphasize":{},"book-summary-scroll-position-saver":{},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        <!-- body:end -->
<!-- body:end -->
    </body>
    <!-- End of book 反扒以及解决方案 -->
<!-- End of book 反扒以及解决方案 -->
</html>
